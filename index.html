<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LINO</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
      padding: 20px;
    }
    h1 {
      color: #f00;
      font-size: 36px;
      letter-spacing: 4px;
    }
    h2 {
      margin-top: 30px;
      color: #ff4444;
    }
    input, button, textarea {
      margin: 10px auto;
      padding: 10px;
      width: 90%;
      max-width: 400px;
      display: block;
      border: none;
      border-radius: 8px;
      background: #222;
      color: #fff;
    }
    button {
      background: #f00;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      background: #c00;
    }
    img {
      max-width: 90%;
      margin: 10px auto;
      display: block;
    }
    #canvas {
      display: none;
    }
    #loginScreen {
      display: block;
    }
    #mainContent {
      display: none;
    }
    #logo {
      font-size: 48px;
      font-weight: bold;
      margin-bottom: 20px;
      color: #f00;
      text-shadow: 2px 2px #000;
    }
  </style>
</head>
<body>

  <div id="loginScreen">
    <div id="logo">LINO</div>
    <input type="password" id="passwordInput" placeholder="Digite a senha de acesso..." />
    <button onclick="checkPassword()">Entrar</button>
  </div>

  <div id="mainContent">
    <h1>LINO</h1>

    <!-- Codificador de Mensagem -->
    <h2>1. Codificar Mensagem em Imagem</h2>
    <input type="file" id="baseImageInput" accept="image/*">
    <textarea id="secretMessage" placeholder="Digite a mensagem secreta..."></textarea>
    <button onclick="encodeMessage()">Codificar</button>
    <a id="downloadLink" style="display:none;" download="imagem_codificada.png">Salvar imagem codificada</a>
    <img id="outputImage" />

    <hr />

    <!-- Decodificador de Mensagem -->
    <h2>2. Decodificar Mensagem</h2>
    <input type="file" id="imageInput" accept="image/*" />
    <button onclick="decodeMessage()">Revelar Mensagem</button>
    <p id="result" style="font-weight: bold; font-size: 18px;"></p>

    <hr />

    <!-- Codificar Imagem dentro de Imagem -->
    <h2>3. Esconder Imagem dentro de outra</h2>
    <input type="file" id="hostImageInput" accept="image/*">
    <input type="file" id="hiddenImageInput" accept="image/*">
    <button onclick="encodeHiddenImage()">Codificar Imagem</button>
    <a id="imgDownloadLink" style="display:none;" download="img_oculta.png">Salvar imagem com outra imagem oculta</a>
    <img id="imgEncodedOutput" />

    <hr />

    <!-- Decodificar Imagem Oculta -->
    <h2>4. Revelar Imagem Oculta</h2>
    <input type="file" id="imgToDecodeInput" accept="image/*" />
    <button onclick="decodeHiddenImage()">Revelar Imagem Oculta</button>
    <img id="decodedHiddenImage" />

    <canvas id="canvas"></canvas>
  </div>

  <script>
    function checkPassword() {
      const password = document.getElementById('passwordInput').value;
      if (password === '458') {
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('mainContent').style.display = 'block';
      } else {
        alert('Senha incorreta!');
      }
    }

    function encodeMessage() {
      const file = document.getElementById("baseImageInput").files[0];
      const message = document.getElementById("secretMessage").value;
      if (!file || !message) {
        alert("Escolha uma imagem e digite a mensagem.");
        return;
      }

      const reader = new FileReader();
      reader.onload = function (e) {
        const img = new Image();
        img.onload = function () {
          const canvas = document.getElementById("canvas");
          const ctx = canvas.getContext("2d");
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);
          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          const data = imageData.data;

          for (let i = 0; i < message.length && i * 4 < data.length; i++) {
            data[i * 4] = message.charCodeAt(i);
          }
          if ((message.length + 1) * 4 < data.length) {
            data[message.length * 4] = 0;
          }

          ctx.putImageData(imageData, 0, 0);
          const dataUrl = canvas.toDataURL("image/png");
          document.getElementById("outputImage").src = dataUrl;
          const link = document.getElementById("downloadLink");
          link.href = dataUrl;
          link.style.display = "block";
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    function decodeMessage() {
      const file = document.getElementById("imageInput").files[0];
      if (!file) {
        alert("Escolha uma imagem primeiro.");
        return;
      }

      const reader = new FileReader();
      reader.onload = function (e) {
        const img = new Image();
        img.onload = function () {
          const canvas = document.getElementById("canvas");
          const ctx = canvas.getContext("2d");
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);
          const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;

          let message = "";
          for (let i = 0; i < 100 * 4 && i < data.length; i += 4) {
            const charCode = data[i];
            if (charCode === 0) break;
            message += String.fromCharCode(charCode);
          }

          const resultEl = document.getElementById("result");
          resultEl.innerText = "Mensagem: " + message;

          setTimeout(() => {
            resultEl.innerText = "";
          }, 30000); // limpa ap√≥s 30 segundos
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    function encodeHiddenImage() {
      const hostFile = document.getElementById("hostImageInput").files[0];
      const hiddenFile = document.getElementById("hiddenImageInput").files[0];
      if (!hostFile || !hiddenFile) {
        alert("Escolha as duas imagens.");
        return;
      }

      const hostReader = new FileReader();
      const hiddenReader = new FileReader();

      hostReader.onload = function (e1) {
        hiddenReader.onload = function (e2) {
          const hostImg = new Image();
          const hiddenImg = new Image();
          hostImg.onload = function () {
            hiddenImg.onload = function () {
              const canvas = document.getElementById("canvas");
              const ctx = canvas.getContext("2d");
              canvas.width = hostImg.width;
              canvas.height = hostImg.height;
              ctx.drawImage(hostImg, 0, 0);
              const hostData = ctx.getImageData(0, 0, canvas.width, canvas.height);

              const tempCanvas = document.createElement("canvas");
              const tempCtx = tempCanvas.getContext("2d");
              tempCanvas.width = hiddenImg.width;
              tempCanvas.height = hiddenImg.height;
              tempCtx.drawImage(hiddenImg, 0, 0);
              const hiddenData = tempCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height);

              for (let i = 0; i < hiddenData.data.length && i < hostData.data.length; i++) {
                hostData.data[i] = (hostData.data[i] & 0b11110000) | (hiddenData.data[i] >> 4);
              }

              ctx.putImageData(hostData, 0, 0);
              const dataUrl = canvas.toDataURL("image/png");
              document.getElementById("imgEncodedOutput").src = dataUrl;
              const link = document.getElementById("imgDownloadLink");
              link.href = dataUrl;
              link.style.display = "block";
            };
            hiddenImg.src = e2.target.result;
          };
          hostImg.src = e1.target.result;
        };
        hiddenReader.readAsDataURL(hiddenFile);
      };
      hostReader.readAsDataURL(hostFile);
    }

    function decodeHiddenImage() {
      const file = document.getElementById("imgToDecodeInput").files[0];
      if (!file) {
        alert("Escolha uma imagem.");
        return;
      }

      const reader = new FileReader();
      reader.onload = function (e) {
        const img = new Image();
        img.onload = function () {
          const canvas = document.getElementById("canvas");
          const ctx = canvas.getContext("2d");
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);
          const data = ctx.getImageData(0, 0, canvas.width, canvas.height);
          const hiddenData = ctx.createImageData(canvas.width, canvas.height);

          for (let i = 0; i < data.data.length; i++) {
            hiddenData.data[i] = (data.data[i] & 0b00001111) << 4;
            if ((i + 1) % 4 === 0) hiddenData.data[i] = 255; // alpha
          }

          ctx.putImageData(hiddenData, 0, 0);
          const dataUrl = canvas.toDataURL("image/png");
          document.getElementById("decodedHiddenImage").src = dataUrl;
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  </script>

</body>
  </html>
