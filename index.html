
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VaultBox Chat</title>
  <style>
    body { font-family: sans-serif; background: #111; color: #eee; margin: 0; padding: 20px; }
    #login { display: flex; flex-direction: column; gap: 10px; max-width: 300px; margin: auto; }
    #chat { display: none; max-width: 600px; margin: auto; }
    #messages { height: 300px; overflow-y: scroll; background: #222; padding: 10px; margin-bottom: 10px; }
    input, button { padding: 10px; border: none; border-radius: 5px; }
    button { background: #28a745; color: white; cursor: pointer; }
  </style>
</head>
<body>
  <div id="login">
    <h2>VaultBox Login</h2>
    <input type="password" id="password" placeholder="Digite a senha" />
    <button onclick="checkPassword()">Entrar</button>
  </div>
  <div id="chat">
    <h2>VaultBox Chat</h2>
    <div id="messages"></div>
    <input type="text" id="msgInput" placeholder="Digite sua mensagem..." />
    <button onclick="sendMessage()">Enviar</button>
  </div>
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    const supabaseUrl = 'https://fcyrellpywnymnbgazzp.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZjeXJlbGxweXdueW1uYmdhenpwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcwNzg0NTEsImV4cCI6MjA2MjY1NDQ1MX0.dEs5Ehmpk-JVWlbARMQkUqKZRFlCJPNczw5QAraN_cs'
    const supabase = createClient(supabaseUrl, supabaseKey)

    const messagesEl = document.getElementById('messages')
    const inputEl = document.getElementById('msgInput')

    async function loadMessages() {
      const { data } = await supabase.from('messages').select('*').order('created_at', { ascending: true })
      messagesEl.innerHTML = data.map(msg => `<div>${msg.text}</div>`).join('')
      messagesEl.scrollTop = messagesEl.scrollHeight
    }

    async function sendMessage() {
      const text = inputEl.value
      if (text.trim() === '') return
      await supabase.from('messages').insert([{ text }])
      inputEl.value = ''
    }

    function checkPassword() {
      const pass = document.getElementById('password').value
      if (pass === '458') {
        document.getElementById('login').style.display = 'none'
        document.getElementById('chat').style.display = 'block'
        loadMessages()
        supabase
          .channel('chat')
          .on('postgres_changes', { event: '*', schema: 'public', table: 'messages' }, loadMessages)
          .subscribe()
      } else {
        alert('Senha incorreta')
      }
    }
  </script>
</body>
</html>
